#!/bin/sh

set -e

# Minimal mounts for userland
mount -t devtmpfs devtmpfs /dev
mount -t proc proc /proc
mount -t sysfs sysfs /sys
mount -t tmpfs tmpfs /run
mount -t tmpfs tmpfs /tmp
mkdir -p /dev/pts /dev/shm /run/lock
mount -t devpts devpts /dev/pts
mount -t tmpfs tmpfs /dev/shm
mkdir -p /var/log

log_phase() {
	# Emit a simple boot marker with kernel uptime
	if [ -r /proc/uptime ]; then
		uptime=$(cut -d' ' -f1 < /proc/uptime)
		printf '[BOOT] %s at %ss\n' "$1" "$uptime"
	fi
}

log_phase "init start"

export HOME=/root
export PATH="/usr/bin:/bin"
export XDG_RUNTIME_DIR=/run

log_phase "starting gui"
exec /usr/bin/python3 /app.py
